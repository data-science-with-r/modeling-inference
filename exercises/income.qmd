---
title: Logistic regression
subtitle: "{{< fa book-open >}} Modeling Inference <br>{{< fa book >}} Data Science with R"
format: live-html
engine: knitr
bibliography: references.bib
webr:
  packages: 
    - tidyverse
    - tidymodels
    # - faraway
    #- scales
    #- ggridges
    # - kableExtra
  cell-options:
    autorun: false
  resources:
---

<!-- begin: webr fodder -->

{{< include ../_extensions/r-wasm/live/_knitr.qmd >}}

```{webr}
#| edit: false
#| echo: false
#| output: false
options("readr.edition" = 1)
library(tidyverse)
# Read the CSV file directly from the URL
income <- read_csv("https://raw.githubusercontent.com/exercises/data/income.csv")
```

<!-- end: webr fodder -->

# Getting Started

Programming exercises are designed to provide an opportunity for you to put what you learn in the videos and readings. These exercises feature interactive code cells which allow you to write, edit, and run R code without leaving your browser.

When the ▶️ Run Code button turns to a solid color (with no flashing bubble indicating that the document is still loading), you can interact with the code cells!

## Packages

We’ll use the **tidyverse** and **tidymodels** packages to make plots and fit models. We will also use the **kableExtra** package to put our output into nice and neat tables. These are already installed for you to use in this programming exercise, run the following code cell to load these packages.

```{r}
#| echo: false
#| message: false
#| warning: false

library(tidyverse)
library(tidymodels)
library(kableExtra)
```

```{webr}
library(tidyverse)
library(tidymodels)
library(kableExtra)
```

## Motivation

Census data is valuable for predicting income because it provides a comprehensive dataset of demographic, social, and economic variables that are strongly correlated with a person's earnings. We can use this information to help gain deeper insights into the economic well-being of a population, which aids in strategic planning, resource allocation, and market analysis. In this programming exercise, we are going to explore the relationship between different predictors, and if an individual was making more or less than \$50,000 a year in 1994.

## Dataset information

The dataset we will be using for this exercise is from the 1994 Census database, extracted by Barry Becker. These data can be found on the [UCI Machine Learning Repository](https://archive.ics.uci.edu/dataset/2/adult). Expand the tab below to look at the data key.

```{r}
your_data <- read.table("exercises/data/adult.data", header = FALSE, sep = ",")

income <- your_data |>
  set_names(vec)

View(income)

income <- income |>
  select(-c(3,11:13)) |>
  filter(workclass != "?") |>
  mutate(income = as.factor(income))

write_csv(income, "income.csv")
```

::: callout-caution
|                |                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|------------------|------------------------------------------------------|
| Variable Name  | Description                                                                                                                                                                                                                                                                                                                                                                                                                     |
| age            | Age                                                                                                                                                                                                                                                                                                                                                                                                                             |
| workclass      | Private, Self-emp-not-inc, Self-emp-inc, Federal-gov, Local-gov, State-gov, Without-pay, Never-worked.                                                                                                                                                                                                                                                                                                                          |
| education      | Bachelors, Some-college, 11th, HS-grad, Prof-school, Assoc-acdm, Assoc-voc, 9th, 7th-8th, 12th, Masters, 1st-4th, 10th, Doctorate, 5th-6th, Preschool.                                                                                                                                                                                                                                                                          |
| education-num  | Education Level as a number                                                                                                                                                                                                                                                                                                                                                                                                     |
| marital-status | Married-civ-spouse, Divorced, Never-married, Separated, Widowed, Married-spouse-absent, Married-AF-spouse.                                                                                                                                                                                                                                                                                                                      |
| occupation     | Tech-support, Craft-repair, Other-service, Sales, Exec-managerial, Prof-specialty, Handlers-cleaners, Machine-op-inspct, Adm-clerical, Farming-fishing, Transport-moving, Priv-house-serv, Protective-serv, Armed-Forces.                                                                                                                                                                                                       |
| relationship   | Wife, Own-child, Husband, Not-in-family, Other-relative, Unmarried.                                                                                                                                                                                                                                                                                                                                                             |
| race           | White, Asian-Pac-Islander, Amer-Indian-Eskimo, Other, Black.                                                                                                                                                                                                                                                                                                                                                                    |
| sex            | Female, Male.                                                                                                                                                                                                                                                                                                                                                                                                                   |
| native-country | United-States, Cambodia, England, Puerto-Rico, Canada, Germany, Outlying-US(Guam-USVI-etc), India, Japan, Greece, South, China, Cuba, Iran, Honduras, Philippines, Italy, Poland, Jamaica, Vietnam, Mexico, Portugal, Ireland, France, Dominican-Republic, Laos, Ecuador, Taiwan, Haiti, Columbia, Hungary, Guatemala, Nicaragua, Scotland, Thailand, Yugoslavia, El-Salvador, Trinadad&Tobago, Peru, Hong, Holand-Netherlands. |
| income         | \>50K, \<=50K.                                                                                                                                           :::

## Exploratory Data Analysis

::: exercise

Before we fit a logistic regression model, we are going to explore the data. Let' start with exploring our response variable of interest, cholesterol (`income`). For this exercise, we are going to explore the relationship between `income` and `age`. 

Let's calculate the mean and sd of `age` for each level of `income`. What does this tell us? When fitting a logistic regression model, would we expect the probability of making more than \$50,000 to increase or decrease as you get older?

```{webr}

```
:::

::: {.callout-tip collapse="true"}
## Solution
```{r}
#| echo: false
income <- read_csv("data/income.csv") 
```

```{r}
income |>
  group_by(income) |>
  summarize(mean_age = mean(age),
            sd_age = sd(age))
```

The mean age for those making less than \$50,000 is roughly 7.4 years younger than the mean age of those making more than \$50,000. The spread (standard deviation) is also higher for those making less than \$50,000 in comparison to those making more. 

Based on this information, we would expect the probability of making more than \$50,000 to increase as age increases. 
:::

### Fitting a logistic regression model
::: exercise
Fit a logisitc regression model below with income as our response, and age as our predictor. Compare your output to the written out model below. Is your respnose the log-odds of making more than \$50,000, or probability?

:::

```{webr}

```



$$
\log \left( \frac{p}{1-p} \right) = -2.74 + 0.0395(\text{age})
$$

::: {.callout-tip collapse="true"}
## Solution
```{r}
income_model <- logistic_reg() |>
  set_engine("glm") |>
  fit(income ~ age , data = income, family = binomial)

tidy(income_model)
```

The logistic regression model we fit models the log-odds: $$\log \left( \frac{p}{1-p} \right)$$, where `p` represents the probability of of making more than \$50,000. 
:::


